# Generate SSH key pair
resource "tls_private_key" "ssh_key" {
  algorithm = "RSA"
  rsa_bits  = 4096
}

# Store the private key in the state file
resource "google_compute_project_metadata_item" "ssh-private-key" {
  key   = "ssh-private-key"
  value = tls_private_key.ssh_key.private_key_pem
}

# Use the public key for SSH access to the VM
resource "google_compute_project_metadata_item" "ssh-keys" {
  key   = "ssh-keys"
  value = "jenkins:${tls_private_key.ssh_key.public_key_openssh}"
}

@@@@@@@@@@@@@
#####################################

---
- hosts: all
  become: true
  tasks:
    - name: Ensure Apache is installed
      apt:
        name: apache2
        state: present

    - name: Ensure Apache service is running
      service:
        name: apache2
        state: started
        enabled: true
